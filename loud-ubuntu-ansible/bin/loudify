#!/bin/bash
#
# usage: sudo bash loudify
#
# Description: 
# This script will take a stock Ubuntu 15.04 system and provision it with
# LOUD using ansible.
#


loudifier()
  {
    # Display Message
    echo "Everything checks out ok..."
    echo "LOUDIFYING FOR THE WIN!"

    # install ansible
    apt-get -y install ansible
    echo "localhost ansible_connection=local" > /etc/ansible/hosts

    # make sure loud-ubuntu-ansible package is installed
    apt-get -y install loud-ubuntu-ansible

    # run ansible
    ansible-playbook /opt/loud/ansible/loud-ubuntu-ansible/loudify.yml

    # Ask user to reboot
    #echo "##############################################################"
    #echo "Scripted completed.  Run sudo reboot to complete installation."
    #echo "##############################################################"
  }


# am I root?
if [ "$(id -u)" != "0" ]; then
   echo "This script must be run as root.  Use sudo loudify" 1>&2
   exit 1
fi

   
# check version
VERSION=`lsb_release -r | awk '{ print $2; }'`

case "$VERSION" in
  "15.04") loudifier "lvivid"
    ;;
  *) echo "Aborting.  Distribution not supported. Please use Ubuntu Ubuntu 15.04 as a base." 1>&2
     exit 1 
   ;;
   esac
